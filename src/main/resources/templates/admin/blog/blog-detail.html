<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout/layout :: layout(~{:: title},~{:: #css},~{:: .content-wrapper},~{:: #js})}">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chi ti·∫øt b√†i vi·∫øt</title>


   <th:block id="css">
       <!--Easymde-->
       <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css" />
       <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css" />

       <!--Summernote-->
       <link rel="stylesheet" href="/admin-assets/plugins/summernote/summernote-bs4.min.css">

       <!--Select2-->
       <link rel="stylesheet" href="/admin-assets/plugins/select2/css/select2.min.css" >

       <link rel="stylesheet" href="/admin-assets/dist/css/style.css">
   </th:block>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-12">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="#">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="#">Blog</a>
                                </li>
                                <li class="breadcrumb-item active" th:text="${blog.getTitle()}">
                                    Th·ª±c h√†nh l√†m ·ª©ng d·ª•ng Meal Finder API
                                    v·ªõi Javascript (Ph·∫ßn 2)
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row py-2">
                        <div class="col-6">
                            <button type="button" class="btn btn-default">
                                <i class="fas fa-chevron-left"></i> Quay l·∫°i
                            </button>
                            <button type="button" class="btn btn-info px-4" id="btnUpdateBlog">
                                L∆∞u
                            </button>
                        </div>

                        <div class="col-6 d-flex justify-content-end">
                            <button type="button" class="btn btn-danger px-4" id="btnDeleteBlog">
                                X√≥a
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <form id="form-blog">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="form-group">
                                                    <label>Ti√™u ƒë·ªÅ</label>
                                                    <input type="text" class="form-control" id="title" name="title" th:value="${blog.getTitle()}"/>
                                                </div>

                                                <div class="form-group">
                                                    <label>N·ªôi dung</label>
                                                    <textarea id="content" name="content" th:text="${blog.getContent()}"></textarea>
                                                    <span class="invalid-feedback"></span>
                                                </div>

                                                <div class="form-group">
                                                    <label>M√¥ t·∫£ ng·∫Øn</label>
                                                    <textarea id="description" name="description" class="form-control" rows="3" th:text="${blog.getDescription()}"></textarea>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Tr·∫°ng th√°i</label>
                                                    <select id="status" class="form-control" th:value="${blog.getStatus()}? '1':'0'">
                                                        <option value="0" th:selected="${!blog.getStatus()}">
                                                            Nh√°p
                                                        </option>
                                                        <option value="1" th:selected="${blog.getStatus()}">
                                                            C√¥ng khai
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <div class="thumbnail-preview-container mb-3">
                                                        <img src="https://media.techmaster.vn/api/static/9479/c6iesrs51cof74mrqnfg" alt="" id="thumbnail">
                                                    </div>
                                                    <label for="input-thumbnail" class="btn btn-info btn-flat" data-toggle="modal" data-target="#modal-xl">
                                                        Ch·ªçn h√¨nh ·∫£nh
                                                    </label>
                                                    <input type="file" id="input-thumbnail" class="d-none">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <th:block id="js">
        //Eassymde
        <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
        <script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>

        //Summernote
        <script src="/admin-assets/plugins/summernote/summernote-bs4.min.js"></script>

        //Select2
        <script src="/admin-assets/plugins/select2/js/select2.full.min.js"></script>

        <script th:inline="javascript">
            // //Initialize Select2 Elements
            // $(".select2").select2();
            //
            // // Initialize editor
            // const easyMDE = new EasyMDE({
            //     element: document.getElementById("content"),
            //     spellChecker: false,
            //     maxHeight: "500px",
            //     renderingConfig: {
            //         codeSyntaxHighlighting: true,
            //     },
            // });
            //
            // // Initialize data
            // const initData = (data) => {
            //     $("#title").val(data.title);
            //     easyMDE.value(data.content);
            //     $("#description").html(data.description);
            //     $("#status").val(data.status);
            //     $("#category").val(data.categories).trigger("change");
            //     $("#thumbnail").attr("src", data.thumbnail);
            // };
            //
            // const blog = {
            //     id: 36870,
            //     title: "L√†m ·ª©ng d·ª•ng Music Player b·∫±ng Javascript",
            //     content:
            //         'Ch√†o c√°c b·∫°n, trong b√†i vi·∫øt n√†y ch√∫ng ta s·∫Ω c√πng nhau l√†m ·ª©ng d·ª•ng nghe nh·∫°c " `Music Player`" b·∫±ng javascript. Ch·∫Øc trong s·ªë ch√∫ng ta ai c≈©ng th√≠ch nghe nh·∫°c ph·∫£i kh√¥ng n√†o, thay v√¨ h·∫±ng ng√†y ch√∫ng ta nghe nh·∫°c qua youtube, qua zing mp3, v·∫≠y t·∫°i sao ch√∫ng ta kh√¥ng t·ª± t·∫°o ra m·ªôt ·ª©ng d·ª•ng nghe nh·∫°c c∆° b·∫£n b·∫±ng ch√≠nh kh·∫£ nƒÉng c·ªßa ch√∫ng ta. C√≥ ph·∫£i s·∫Ω th√∫ v·ªã h∆°n kh√¥ng üòÅüòÅ\n\nV·ªõi ·ª©ng d·ª•ng Music Player ch√∫ng ta c√≥ th·ªÉ l√†m c√°c ch·ª©c nƒÉng ƒë∆°n gi·∫£n sau:\n\n- Play b√†i h√°t\n- Pause b√†i h√°t\n- Chuy·ªÉn b√†i qua l·∫°i\n- Tua b√†i h√°t\n- ...\n\nƒê√¢y l√† giao di·ªán ·ª©ng d·ª•ng Music Player ban ƒë·∫ßu ch√∫ng ta, m√¨nh ƒë·ªÉ link source ·ªü ƒë√¢y ƒë·ªÉ c√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o : [https://github.com/buihien0109/music-player/tree/main/start](https://github.com/buihien0109/music-player/tree/main/start)\n\nNgo√†i ra c√°c b·∫°n c√≥ th·ªÉ t·∫°o giao di·ªán ·ª©ng d·ª•ng theo √Ω th√≠ch v√† phong c√°ch c·ªßa m√¨nh\n\n![demo music player app](https://media.techmaster.vn/api/static/9479/c6iesrs51cof74mrqnfg)\n\nB·∫Øt ƒë·∫ßu th√¥i n√†o üòÅüòÅüòÅ\n\n### Hi·ªÉn th·ªã th√¥ng tin b√†i h√°t\n\nM·∫∑c ƒë·ªãnh ban ƒë·∫ßu ch√∫ng ta s·∫Ω hi·ªÉn th·ªã ra 1 b√†i h√°t b·∫•t k·ª≥ v·ªõi ti√™u ƒë·ªÅ, audio v√† ·∫£nh t∆∞∆°ng ·ª©ng v·ªõi b√†i h√°t ƒë√≥\n\n```javascript\nconst audio = document.getElementById("audio");\nconst title = document.getElementById("title");\nconst cover = document.getElementById("cover");\n\n// Ti√™u ƒë·ªÅ b√†i h√°t, t∆∞∆°ng ·ª©ng v·ªõi c√°c file mp3\nconst songs = ["mot_phut", "hen_yeu", "roi_xa"];\n\n// L·∫•y index b·∫•t k·ª≥ trong m·∫£ng songs ƒë·ªÉ hi·ªán th·ªã\nlet songIndex = 2;\n\n// Load 1 b√†i h√°t theo index\nloadSong(songs[songIndex]);\n\n// C·∫≠p nh·∫≠t th√¥ng tin b√†i h√°t\nfunction loadSong(song) {\n    title.innerText = song;\n    audio.src = `music/${song}.mp3`;\n    cover.src = `images/${song}.jpg`;\n}\n```\n\nHi·ªán t·∫°i trong project, ch√∫ng ta mockup s·∫µn 3 audio t∆∞∆°ng ·ª©ng l√† c√°c gi√° tr·ªã trong m·∫£ng **songs**\n\nFunction **loadSong** gi√∫p ch√∫ng ta hi·ªÉn th·ªã th√¥ng tin b√†i h√°t\n\n### Play & Pause\n\nM·∫∑c ƒë·ªãnh ban ƒë·∫ßu th√¨ b√†i h√°t ·ªü tr·∫°ng th√°i " `pause`", ch√∫ng ta s·∫Ω th·ª±c hi·ªán click ƒë·ªÉ play audio\n\nTuy nhi√™n ch√∫ng ta c·∫ßn ph·∫£i bi·∫øt khi n√†o th√¨ play, khi n√†o th√¨ pause. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, ch√∫ng ta s·∫Ω ph·ª• thu·ªôc v√†o class " `play`" trong element " `musicContainer`"\n\nƒê·ªãnh nghƒ©a 2 function :\n\n- `playSong` ƒë·ªÉ ph√°t nh·∫°c\n- `pauseSong` ƒë·ªÉ tam d·ª´ng\n\n```javascript\nconst musicContainer = document.getElementById("music-container");\nconst playBtn = document.getElementById("play");\n\n// Play song\nfunction playSong() {\n    musicContainer.classList.add("play");\n    playBtn.querySelector("i.fas").classList.remove("fa-play");\n    playBtn.querySelector("i.fas").classList.add("fa-pause");\n\n    audio.play();\n}\n\n// Pause song\nfunction pauseSong() {\n    musicContainer.classList.remove("play");\n    playBtn.querySelector("i.fas").classList.add("fa-play");\n    playBtn.querySelector("i.fas").classList.remove("fa-pause");\n\n    audio.pause();\n}\n\n// L·∫Øng nghe s·ª± ki·ªán\nplayBtn.addEventListener("click", () => {\n    // Ki·ªÉm tra xem musicContainer c√≥ ch·ª©a class "play" hay kh√¥ng?\n    const isPlaying = musicContainer.classList.contains("play");\n\n    // N·∫øu c√≥ th√¨ th·ª±c hi·ªán pause\n    // N·∫øu kh√¥ng th√¨ th·ª±c hi·ªán play\n    if (isPlaying) {\n        pauseSong();\n    } else {\n        playSong();\n    }\n});\n```\n\n### Progress song\n\nTheo m·∫∑c ƒë·ªãnh l√† khi ch√∫ng ta b·∫Øt ƒë·∫ßu 1 b√†i h√°t m·ªõi th√¨ thanh ti·∫øn tr√¨nh (progress bar) b·∫Øt ƒë·∫ßu ch·∫°y, d·ª±a v√†o progress ch√∫ng ta c√≥ th·ªÉ bi·∫øt ƒë∆∞·ª£c ti·∫øn ƒë·ªô ph√°t b√†i h√°t. ƒê·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu n√†y, ch√∫ng ta l·∫Øng nghe s·ª± ki·ªán " `timeupdate`" c·ªßa `audio` element, v√† g·ªçi h√†m x·ª≠ l√Ω t∆∞∆°ng ·ª©ng l√† `updateProgress`.\n\nS·ª± ki·ªán " `timeUpdate`" ƒë∆∞·ª£c k√≠ch ho·∫°t khi v·ªã tr√≠ ph√°t c·ªßa audio/video b·ªã thay ƒë·ªïi.\n\nNgo√†i ra, ch√∫ng ta c√≥ th·ªÉ "tua" nhanh b√†i h√°t ƒë·∫øn 1 v·ªã tr√≠ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh tr√™n thanh progress. ·ªû ƒë√¢y ch√∫ng ta s·∫Ω l·∫Øng nghe s·ª± ki·ªán "click" tr√™n `progressContainer` element ƒë·ªÉ update `currentTime` c·ªßa audio\n\n```javascript\nconst progress = document.getElementById("progress");\nconst progressContainer = document.getElementById("progress-container");\n\n// Time/song update\naudio.addEventListener("timeupdate", updateProgress);\n\n// Click on progress bar\nprogressContainer.addEventListener("click", setProgress);\n\n// Update progress bar\nfunction updateProgress(e) {\n    const { duration, currentTime } = e.srcElement;\n    const progressPercent = (currentTime / duration) * 100;\n    progress.style.width = `${progressPercent}%`;\n}\n\n// Set progress bar\nfunction setProgress(e) {\n    const width = this.clientWidth;\n    const clickX = e.offsetX;\n    const duration = audio.duration;\n\n    audio.currentTime = (clickX / width) * duration;\n}\n```\n\n### Next song & Prev song\n\nM·ªôt t√≠nh nƒÉng r·∫•t quan tr·ªçng trong m·ªôt ·ª©ng d·ª•ng "`Music Player`" l√† next v√† prev b√†i h√°t. ƒê·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu n√†y ch√∫ng ta l·∫Øng nghe s·ª± ki·ªán "click" tr√™n 2 n√∫t `nextBtn` g·ªçi h√†m x·ª≠ l√Ω `nextSong` ƒë·ªÉ th·ª±c hi·ªán next b√†i h√°t v√† n√∫t `prevBtn` g·ªçi h√†m x·ª≠ l√Ω `prevSong` ƒë·ªÉ th·ª±c hi·ªán prev b√†i h√°t\n\n```javascript\nconst prevBtn = document.getElementById("prev");\nconst nextBtn = document.getElementById("next");\n\n// L·∫Øng nghe s·ª± ki·ªán khi next v√† prev b√†i h√°t\nprevBtn.addEventListener("click", prevSong);\nnextBtn.addEventListener("click", nextSong);\n\n// L·∫Øng nghe s·ª± ki·ªán khi k·∫øt th√∫c b√†i h√°t\naudio.addEventListener("ended", nextSong);\n\n// X·ª≠ l√Ω khi prev b√†i h√°t\nfunction prevSong() {\n    // Gi·∫£m index c·ªßa songIndex ƒëi 1\n    songIndex--;\n\n    // N·∫øu ƒëang l√† b√†i h√°t ƒë·∫ßu th√¨ quay l·∫°i b√†i h√°t cu·ªëi\n    if (songIndex < 0) {\n        songIndex = songs.length - 1;\n    }\n\n    // C·∫≠p nh·∫≠t th√¥ng tin c·ªßa b√†i h√°t l√™n giao di·ªán\n    loadSong(songs[songIndex]);\n\n    // Ph√°t nh·∫°c\n    playSong();\n}\n\n// X·ª≠ l√Ω khi next b√†i h√°t\nfunction nextSong() {\n    // TƒÉng index c·ªßa songIndex l√™n 1\n    songIndex++;\n\n    // N·∫øu ƒëang l√† b√†i h√°t cu·ªëi th√¨ quay l·∫°i b√†i h√°t ƒë·∫ßu\n    if (songIndex > songs.length - 1) {\n        songIndex = 0;\n    }\n\n    // C·∫≠p nh·∫≠t th√¥ng tin c·ªßa b√†i h√°t l√™n giao di·ªán\n    loadSong(songs[songIndex]);\n\n    // Ph√°t nh·∫°c\n    playSong();\n}\n```\n\nV√† ƒë√¢y l√† k·∫øt qu·∫£ cu·ªëi c√πng c·ªßa ch√∫ng ta\n\n![k·∫øt qu·∫£](https://media.techmaster.vn/api/static/9479/c6ioqls51cof74mrqnh0)\n\nV·∫≠y l√† ch√∫ng ta ƒë√£ ho√†n th√†nh ·ª©ng d·ª•ng "Music Player" v·ªõi c√°c ch·ª©c nƒÉng c∆° b·∫£n. Hi v·ªçng c√°c b·∫°n th·∫•y b√†i vi·∫øt n√†y h·ªØu √≠ch v√† th√∫ v·ªã üòÅüòÅüòÅ\n\nPh·∫ßn sources code c·ªßa b√†i vi·∫øt n√†y, c√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o t·∫°i ƒë√¢y: [https://github.com/buihien0109/music-player/tree/main/final](https://github.com/buihien0109/music-player/tree/main/final)\n\n> C√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o th√™m kh√≥a h·ªçc n√†y nh√©:\n\n- Javascript cƒÉn b·∫£n - T·ªïng h·ª£p 12 game huy·ªÅn tho·∫°i - [t·∫°i ƒë√¢y](https://techmaster.vn/khoa-hoc/ev5/javascript-can-ban-tong-hop-12-game-huyen-thoai).\n- L·∫≠p tr√¨nh Game Javascript (tr·ª±c tuy·∫øn c√≥ t∆∞∆°ng t√°c) - [t·∫°i ƒë√¢y](https://codegame.techmaster.vn/).',
            //     description:
            //         "Ch√†o c√°c b·∫°n, trong b√†i vi·∫øt n√†y ch√∫ng ta s·∫Ω c√πng nhau l√†m ·ª©ng d·ª•ng nghe nh·∫°c &#34;Music Player&#34; b·∫±ng javascript\n",
            //     thumbnail:
            //         "https://media.techmaster.vn/api/static/9479/c6iesrs51cof74mrqnfg",
            //     status: 1,
            //     categories: ["Golang", "Java", "L·∫≠p tr√¨nh web"],
            // };
            //
            // initData(blog);



            // Summernote
            $('#content').summernote({
                height: 600,                 // set editor height
                minHeight: null,             // set minimum height of editor
                maxHeight: null,             // set maximum height of editor
                focus: true,                 // set focus to editable area after initializing summernote
                disableLinkTarget: true
            });
            let blog = [[${blog}]]
            console.log(blog)
            let titleEl = document.getElementById("title")
            let descriptionEl = document.getElementById("description")
            let statusEl = document.getElementById("status")
            const btnUpdateBlog = document.getElementById("btnUpdateBlog")
            const btnDeleteBlog = document.getElementById("btnDeleteBlog")

            btnUpdateBlog.addEventListener("click", async (e)=>{
                e.preventDefault()
                if (!$('#form-blog').valid()){
                    return;
                }
                let content = $('#content').summernote('code');
                const data = {
                    title: titleEl.value,
                    content: content,
                    description: descriptionEl.value,
                    status : statusEl.value === "1",
                }
                // G·ªçi API
                try {
                    let res = await axios.put(`/api/admin/blogs/${blog.id}`, data);
                    toastr.success("C·∫≠p nh·∫≠t blog th√†nh c√¥ng")
                } catch (e) {
                    console.log(e)
                    toastr.error(e.response.data.message);
                }
            })

            btnDeleteBlog.addEventListener("click", async (e)=>{
                const confirm = window.confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ko")
                if(confirm){
                    try {
                        const deleteRv = await axios.delete(`/api/admin/blogs/${blog.id}`)
                        console.log("S·ª± ki·ªán x√≥a blog")
                        toastr.success("X√≥a th√†nh c√¥ng ƒë√°nh gi√°")
                        setTimeout(()=>{
                            window.location.href='/admin/blogs'
                        },1000)
                    } catch (error) {
                        console.log(error)
                    }
                }
            })

            $('#form-blog').validate({
                rules: {
                    title: {
                        required: true,
                        pattern: /^\s*\S.*$/, // Ki·ªÉm tra xem c√≥ k√Ω t·ª± n√†o kh√¥ng l√† kho·∫£ng tr·∫Øng ·ªü ƒë·∫ßu kh√¥ng
                    },
                    content: {
                        required: true,
                        pattern: /^\s*\S.*$/, // Ki·ªÉm tra xem c√≥ k√Ω t·ª± n√†o kh√¥ng l√† kho·∫£ng tr·∫Øng ·ªü ƒë·∫ßu kh√¥ng
                    },
                    description:{
                        required: true,
                        pattern: /^\s*\S.*$/, // Ki·ªÉm tra xem c√≥ k√Ω t·ª± n√†o kh√¥ng l√† kho·∫£ng tr·∫Øng ·ªü ƒë·∫ßu kh√¥ng
                    }
                },
                messages: {
                    title: {
                        required: "Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ",
                        pattern: "Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c ch·ªâ ch·ª©a kho·∫£ng tr·∫Øng"
                    },
                    content: {
                        required: "Vui l√≤ng nh·∫≠p n·ªôi dung",
                        pattern: "N·ªôi dung kh√¥ng ƒë∆∞·ª£c ch·ªâ ch·ª©a kho·∫£ng tr·∫Øng"
                    },
                    description:{
                        required: "Vui l√≤ng nh·∫≠p m√¥ t·∫£",
                        pattern: "M√¥ t·∫£ kh√¥ng ƒë∆∞·ª£c ch·ªâ ch·ª©a kho·∫£ng tr·∫Øng"
                    }
                },
                errorPlacement: function (error, element) {
                    if (element.attr("name") === "content") { // Ki·ªÉm tra n·∫øu l√† tr∆∞·ªùng n·ªôi dung
                        error.appendTo(element.siblings("span")); // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói b√™n c·∫°nh tr∆∞·ªùng n·ªôi dung
                    } else {
                        error.addClass('invalid-feedback');
                        element.closest('.form-group').append(error);
                    }
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                }
            });



            //Upload Image
            const inputThumbnailEl = document.getElementById("input-thumbnail")
            const thumbnailEl = document.getElementById("thumbnail")
            inputThumbnailEl.addEventListener("change",async (event) =>{
                //l·∫•y file upload
                const files = event.target.files;

                //T·∫°o ƒë·ªëi t∆∞·ª£ng form data
                const formData = new FormData();
                formData.append("file",files[0])

                //G·ªçi API
                try {
                    let res = await axios.post(`/api/admin/blogs/${blog.id}/upload-thumbnail`,formData)
                    console.log(res)
                    thumbnailEl.src = res.data;
                }catch (e){
                    console.log(e)
                }
            })
        </script>
    </th:block>

</body>

</html>